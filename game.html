<!DOCTYPE html>
<meta charset="utf-8" />
<title>WebSocket Game Test</title>

<script language="javascript" type="text/javascript">

  var gameId = false;
	var clientId = false;
	
  function init()
  {
    output = document.getElementById("output");
    serverWebsocket();
  }

  function serverWebsocket()
  {
    server = new WebSocket("ws://localhost:10000/game");
    server.onopen = function(evt) { 
			console.log("requesting game id");
	  };
    server.onclose = function(evt) { console.log("game DISCONNECTED"); };
    server.onmessage = function(evt) { 
			// save game id on first message
			if(!gameId) { 
				gameId = evt.data;
				console.log('game id: ' + evt.data);
				clientWebsocket(gameId);
			}	else {
				console.log("message received: " + evt.data)
				//server.send("all Hello Players!")
			}
			
	 	};
    server.onerror = function(evt) { 
			console.error(evt.data); 
		};
  }

	function clientWebsocket(id)
	{
		console.log("try to connect to game: " + id);
		client = new WebSocket("ws://localhost:10000/" + id + "/connect/Webclient");
    client.onopen = function(evt) { 
			console.log("connected to game");
	  };
    client.onclose = function(evt) { 
			console.log("client: DISCONNECTED"); 
		};
    client.onmessage = function(evt) { 
			// save game id on first message
			if(!clientId) { 
				clientId = evt.data;
				console.log('client id: ' + evt.data);
			} else {
				console.log("message received: " + evt.data)
				//client.close();
			}
	 	};
    client.onerror = function(evt) { 
			console.error(evt.data); 
		};
	}

  window.addEventListener("load", init, false);

</script>

<h2>WebSocket Test</h2>

</html>